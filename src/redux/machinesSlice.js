import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';
import axios from 'axios';

const mockMachineStatusData = [
  {
    td9_machine_state: 1,
    td9_stop_reason: -1,
    td9_machine_name: 'BIT 1250',
    td9_line_speed: 120,
    td9_recipe: '16',
    td9_main_cable_lay_length: 93,
    td9_stranding_direction: true,
    td9_pay_off_number: 0,
    td9_operator: 'operator 1',
    td9_ID: 0,
    td9_length_counter_set: 10200,
    td9_length_counter_act: 8600,
    td9_operator_working_time: 348,
    td9_time_break_down: 30,
    td9_remaining_time_mn: 13,
    td9_remaining_time_hour: 0,
    td9_cable_diameter: 4.900000095367432,
    td9_product_consumed_power: 160,
    td9_instantaneous_consumed_power: 40,
    td9_TRS: 67,
    td9_quantity_in: 5000,
    td9_meter_reached: false,
    pb16_machine_state: 1,
    pb16_stop_reason: -1,
    pb16_machine_name: 'AYMAK MAKINE',
    pb16_line_speed: 750,
    pb16_recipe: '10',
    pb16_stranding_direction: false,
    pb16_pay_off_number: 0,
    pb16_operator: 'operator 2',
    pb16_ID: 0,
    pb16_extruder_working: 2,
    pb16_length_counter_set: 5000,
    pb16_length_counter_act: 4200,
    pb16_operator_working_time: 345,
    pb16_time_break_down: 28,
    pb16_remaining_time_mn: 18,
    pb16_remaining_time_hour: 0,
    pb16_cable_diameter: 15.899999618530273,
    pb16_product_consumed_power: 640,
    pb16_instantaneous_consumed_power: 112,
    pb16_TRS: 70,
    pb16_meter_reached: false,
    pb16_quantity_in: 10000,
    pb16_extruder_1_heat_zone_1: 85.4000015258789,
    pb16_extruder_1_heat_zone_2: 86.19999694824219,
    pb16_extruder_1_heat_zone_3: 86.30000305175781,
    pb16_extruder_1_heat_zone_4: 86.9000015258789,
    pb16_extruder_2_heat_zone_1: 0,
    pb16_extruder_2_heat_zone_2: 0,
    pb16_extruder_2_heat_zone_3: 0,
    cb2_machine_state: 1,
    cb2_stop_reason: -1,
    cb2_machine_name: 'Rigid Stranders',
    cb2_cable_diameter: 18.700000762939453,
    cb2_pay_off_number: 0,
    cb2_line_speed: 21.100000381469727,
    cb2_operator: 'operator 3',
    cb2_ID: 0,
    cb2_length_counter_set: 2410,
    cb2_length_counter_act: 1686,
    cb2_remaining_time_min: 10,
    cb2_remaining_time_hour: 0,
    cb2_operator_working_time: 411,
    cb2_time_break_down: 17,
    cb2_product_consumed_power: 803,
    cb2_instantaneous_consumed_power: 110,
    cb2_TRS: 80,
    cb2_quantity_in: 5000,
    cb2_meter_reached: false,
    cb2_recipe: '',
    updated: '2023-08-30T11:05:19.358Z',
    id: '64ef226f3ccd15095e3a0a3f',
  },
  {
    td9_machine_state: 1,
    td9_stop_reason: -1,
    td9_machine_name: 'BIT 1250',
    td9_line_speed: 120,
    td9_recipe: '16',
    td9_main_cable_lay_length: 93,
    td9_stranding_direction: true,
    td9_pay_off_number: 0,
    td9_operator: 'operator 1',
    td9_ID: 0,
    td9_length_counter_set: 10200,
    td9_length_counter_act: 8600,
    td9_operator_working_time: 348,
    td9_time_break_down: 30,
    td9_remaining_time_hour: 0,
    td9_cable_diameter: 4.900000095367432,
    td9_product_consumed_power: 160,
    td9_instantaneous_consumed_power: 40,
    td9_TRS: 67,
    td9_quantity_in: 5000,
    td9_meter_reached: false,
    pb16_machine_state: 1,
    pb16_stop_reason: -1,
    pb16_machine_name: 'AYMAK MAKINE',
    pb16_line_speed: 750,
    pb16_recipe: '10',
    pb16_stranding_direction: false,
    pb16_pay_off_number: 0,
    pb16_operator: 'operator 2',
    pb16_ID: 0,
    pb16_extruder_working: 2,
    pb16_length_counter_set: 5000,
    pb16_length_counter_act: 4200,
    pb16_operator_working_time: 345,
    pb16_time_break_down: 28,
    pb16_remaining_time_hour: 0,
    pb16_cable_diameter: 15.899999618530273,
    pb16_product_consumed_power: 640,
    pb16_instantaneous_consumed_power: 112,
    pb16_TRS: 70,
    pb16_meter_reached: false,
    pb16_quantity_in: 10000,
    pb16_extruder_1_heat_zone_1: 85.4000015258789,
    pb16_extruder_1_heat_zone_2: 86.19999694824219,
    pb16_extruder_1_heat_zone_3: 86.30000305175781,
    pb16_extruder_1_heat_zone_4: 86.9000015258789,
    pb16_extruder_2_heat_zone_1: 0,
    pb16_extruder_2_heat_zone_2: 0,
    pb16_extruder_2_heat_zone_3: 0,
    cb2_machine_state: 1,
    cb2_stop_reason: -1,
    cb2_machine_name: 'Rigid Stranders',
    cb2_cable_diameter: 18.700000762939453,
    cb2_pay_off_number: 0,
    cb2_line_speed: 21.100000381469727,
    cb2_operator: 'operator 3',
    cb2_ID: 0,
    cb2_length_counter_set: 2410,
    cb2_length_counter_act: 1686,
    cb2_remaining_time_min: 10,
    cb2_remaining_time_hour: 0,
    cb2_operator_working_time: 411,
    cb2_time_break_down: 17,
    cb2_product_consumed_power: 803,
    cb2_instantaneous_consumed_power: 110,
    cb2_TRS: 80,
    cb2_quantity_in: 5000,
    cb2_meter_reached: false,
    cb2_recipe: '',
    updated: '2023-08-30T11:47:43.846Z',
    id: '64ef2c5fad95c6e73a83c3d9',
  },
  {
    td9_machine_state: 1,
    td9_stop_reason: -1,
    td9_machine_name: 'BIT 1250',
    td9_line_speed: 120,
    td9_recipe: '16',
    td9_main_cable_lay_length: 93,
    td9_stranding_direction: true,
    td9_pay_off_number: 0,
    td9_operator: 'operator 1',
    td9_ID: 0,
    td9_length_counter_set: 10200,
    td9_length_counter_act: 8600,
    td9_operator_working_time: 348,
    td9_time_break_down: 30,
    td9_remaining_time_hour: 0,
    td9_cable_diameter: 4.900000095367432,
    td9_product_consumed_power: 160,
    td9_instantaneous_consumed_power: 40,
    td9_TRS: 67,
    td9_quantity_in: 5000,
    td9_meter_reached: false,
    pb16_machine_state: 1,
    pb16_stop_reason: -1,
    pb16_machine_name: 'AYMAK MAKINE',
    pb16_line_speed: 750,
    pb16_recipe: '10',
    pb16_stranding_direction: false,
    pb16_pay_off_number: 0,
    pb16_operator: 'operator 2',
    pb16_ID: 0,
    pb16_extruder_working: 2,
    pb16_length_counter_set: 5000,
    pb16_length_counter_act: 4200,
    pb16_operator_working_time: 345,
    pb16_time_break_down: 28,
    pb16_remaining_time_hour: 0,
    pb16_cable_diameter: 15.899999618530273,
    pb16_product_consumed_power: 640,
    pb16_instantaneous_consumed_power: 112,
    pb16_TRS: 70,
    pb16_meter_reached: false,
    pb16_quantity_in: 10000,
    pb16_extruder_1_heat_zone_1: 85.4000015258789,
    pb16_extruder_1_heat_zone_2: 86.19999694824219,
    pb16_extruder_1_heat_zone_3: 86.30000305175781,
    pb16_extruder_1_heat_zone_4: 86.9000015258789,
    pb16_extruder_2_heat_zone_1: 0,
    pb16_extruder_2_heat_zone_2: 0,
    pb16_extruder_2_heat_zone_3: 0,
    cb2_machine_state: 1,
    cb2_stop_reason: -1,
    cb2_machine_name: 'Rigid Stranders',
    cb2_cable_diameter: 18.700000762939453,
    cb2_pay_off_number: 0,
    cb2_line_speed: 21.100000381469727,
    cb2_operator: 'operator 3',
    cb2_ID: 0,
    cb2_length_counter_set: 2410,
    cb2_length_counter_act: 1686,
    cb2_remaining_time_min: 10,
    cb2_remaining_time_hour: 0,
    cb2_operator_working_time: 411,
    cb2_time_break_down: 17,
    cb2_product_consumed_power: 803,
    cb2_instantaneous_consumed_power: 110,
    cb2_TRS: 80,
    cb2_quantity_in: 5000,
    cb2_meter_reached: false,
    cb2_recipe: '',
    updated: '2023-08-30T11:47:53.814Z',
    id: '64ef2c69ad95c6e73a83c3dc',
  },
  {
    td9_machine_state: 1,
    td9_stop_reason: -1,
    td9_machine_name: 'BIT 1250',
    td9_line_speed: 120,
    td9_recipe: '16',
    td9_main_cable_lay_length: 93,
    td9_stranding_direction: true,
    td9_pay_off_number: 0,
    td9_operator: 'operator 1',
    td9_ID: 0,
    td9_length_counter_set: 10200,
    td9_length_counter_act: 8600,
    td9_operator_working_time: 348,
    td9_time_break_down: 30,
    td9_remaining_time_min: 13,
    td9_remaining_time_hour: 0,
    td9_cable_diameter: 4.900000095367432,
    td9_product_consumed_power: 160,
    td9_instantaneous_consumed_power: 40,
    td9_TRS: 67,
    td9_quantity_in: 5000,
    td9_meter_reached: false,
    pb16_machine_state: 1,
    pb16_stop_reason: -1,
    pb16_machine_name: 'AYMAK MAKINE',
    pb16_line_speed: 750,
    pb16_recipe: '10',
    pb16_stranding_direction: false,
    pb16_pay_off_number: 0,
    pb16_operator: 'operator 2',
    pb16_ID: 0,
    pb16_extruder_working: 2,
    pb16_length_counter_set: 5000,
    pb16_length_counter_act: 4200,
    pb16_operator_working_time: 345,
    pb16_time_break_down: 28,
    pb16_remaining_time_min: 18,
    pb16_remaining_time_hour: 0,
    pb16_cable_diameter: 15.899999618530273,
    pb16_product_consumed_power: 640,
    pb16_instantaneous_consumed_power: 112,
    pb16_TRS: 70,
    pb16_meter_reached: false,
    pb16_quantity_in: 10000,
    pb16_extruder_1_heat_zone_1: 85.4000015258789,
    pb16_extruder_1_heat_zone_2: 86.19999694824219,
    pb16_extruder_1_heat_zone_3: 86.30000305175781,
    pb16_extruder_1_heat_zone_4: 86.9000015258789,
    pb16_extruder_2_heat_zone_1: 0,
    pb16_extruder_2_heat_zone_2: 0,
    pb16_extruder_2_heat_zone_3: 0,
    cb2_machine_state: 1,
    cb2_stop_reason: -1,
    cb2_machine_name: 'Rigid Stranders',
    cb2_cable_diameter: 18.700000762939453,
    cb2_pay_off_number: 0,
    cb2_line_speed: 21.100000381469727,
    cb2_operator: 'operator 3',
    cb2_ID: 0,
    cb2_length_counter_set: 2410,
    cb2_length_counter_act: 1686,
    cb2_remaining_time_min: 10,
    cb2_remaining_time_hour: 0,
    cb2_operator_working_time: 411,
    cb2_time_break_down: 17,
    cb2_product_consumed_power: 803,
    cb2_instantaneous_consumed_power: 110,
    cb2_TRS: 80,
    cb2_quantity_in: 5000,
    cb2_meter_reached: false,
    cb2_recipe: '',
    updated: '2023-08-30T11:48:13.832Z',
    id: '64ef2c7dad95c6e73a83c3df',
  },
];

// Define an async thunk to fetch machine status data
export const fetchMachineStatus = createAsyncThunk(
  'machines/fetchMachineStatus',
  async () => {
    const response = await axios.get(process.env.REACT_APP_BACEND_URL);
    return response.data;
  }
);

// Define an async thunk to periodically update machine status data
export const updateMachineStatusPeriodically = createAsyncThunk(
  'machines/updateMachineStatusPeriodically',
  async () => {
    const response = await axios.get(process.env.REACT_APP_BACEND_URL);
    return response.data;
  }
);

// Create a machines slice
const machinesSlice = createSlice({
  name: 'machines',
  initialState: {
    data: mockMachineStatusData,
    loading: false,
    error: null,
  },
  reducers: {
    removeMachines: (state) => {
      state = {
        data: [],
        loading: false,
        error: null,
      };
    },
  },
  extraReducers: (builder) => {
    builder
      .addCase(fetchMachineStatus.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(fetchMachineStatus.fulfilled, (state, action) => {
        state.loading = false;
        state.data = action.payload;
      })
      .addCase(fetchMachineStatus.rejected, (state, action) => {
        state.loading = false;
        state.error = action.error.message;
      })
      .addCase(updateMachineStatusPeriodically.fulfilled, (state, action) => {
        state.data = action.payload;
      });
  },
});

export const { removeMachines } = machinesSlice.actions;

export default machinesSlice.reducer;

// Thunk to start periodic updates
export const startPeriodicUpdates = () => (dispatch) => {
  const intervalId = setInterval(() => {
    dispatch(updateMachineStatusPeriodically());
  }, 5000); // Update every 5 seconds

  // Clear the interval when needed, for example when component unmounts
  return () => clearInterval(intervalId);
};
